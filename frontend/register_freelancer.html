<html>
<head>
    <meta charset="utf-8" />
    <meta content="width=device-width, initial-scale=1.0" name="viewport"/>
    <title>AssisFreela - Registro de Freelancer</title>
    <link rel="icon" href="../img/icone_raio.png" type="image/png">
    
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@800&family=Poppins:wght@400;600&display=swap" rel="stylesheet"/>
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet"/>
    
    <script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
    
    <script>
        tailwind.config = {
            darkMode: "class",
            theme: {
                extend: {
                    colors: {
                        primary: "#FFB300", // Amarelo AssisFreela
                        "text-light": "#000000",
                        "text-dark": "#FFFFFF",
                    },
                    fontFamily: {
                        display: ["Montserrat", "sans-serif"],
                        body: ["Poppins", "sans-serif"],
                    },
                },
            },
        };
    </script>
    <style>
        .font-display { font-family: 'Montserrat', sans-serif; font-weight: 800; }
        .font-body { font-family: 'Poppins', sans-serif; }
    </style>
</head>

<body class="font-body">
  <div class="flex min-h-screen w-full flex-col lg:flex-row">
    
    <!-- LADO ESQUERDO (PRETO) -->
    <div class="hidden lg:flex w-1/2 items-center justify-center bg-black text-white relative overflow-hidden">
      <div class="z-10 text-center px-10">
        <div class="mb-8">
          <img src="./img/logo_reto.jpeg" alt="Logo AssisFreela" class="h-16 w-auto mx-auto">
        </div>
        <h1 class="text-3xl font-display mb-4">Conectando talentos e oportunidades.</h1>
        <p class="text-lg text-gray-400">Entre para ter visibilidade e agilidade.</p>
        <!-- <img src="./img/icone_raio.png" alt="Ícone de raio" class="h-25 w-auto mt-12 animate-pulse mx-auto"> -->
      </div>
    </div>


        <div class="layout-container flex h-full min-h-screen grow flex-col lg:w-1/2 bg-white">
            
            <main class="flex flex-1 items-center justify-center px-4 py-10">
                <div class="w-full max-w-[512px] bg-white rounded-2xl p-8 text-center">
                    
                    <h2 class="text-text-light font-display text-[28px] font-bold leading-tight pb-3">Cadastre-se como Freelancer</h2>
                    <p class="text-gray-600 font-body text-base font-normal pb-6">Preencha os campos abaixo para criar sua conta gratuita.</p>
                    
                    <form id="register-form" class="space-y-4">
                        
                        <div class="space-y-4 pt-2">
                            <label class="flex flex-col min-w-40 flex-1 text-left">
                                <p class="text-text-light text-base font-medium leading-normal pb-2">Nome completo</p>
                                <input id="freela-fullname" placeholder="Ex: Ana Silva"
                                    class="form-input w-full rounded-lg text-text-light bg-gray-100 h-14 placeholder:text-gray-500 p-4 border border-gray-300 focus:border-primary focus:ring-0" />
                            </label>
                            
                            <label class="flex flex-col min-w-40 flex-1 text-left">
                                <p class="text-text-light text-base font-medium leading-normal pb-2">Data de nascimento</p>
                                <input id="freela-birthdate" placeholder="DD/MM/AAAA"
                                    class="form-input w-full rounded-lg text-text-light bg-gray-100 h-14 placeholder:text-gray-500 p-4 border border-gray-300 focus:border-primary focus:ring-0" />
                            </label>
                            
                            <label class="flex flex-col min-w-40 flex-1 text-left">
                                <p class="text-text-light text-base font-medium leading-normal pb-2">E-mail pessoal</p>
                                <input id="freela-email" type="email" placeholder="Ex: ana.silva@email.com"
                                    class="form-input w-full rounded-lg text-text-light bg-gray-100 h-14 placeholder:text-gray-500 p-4 border border-gray-300 focus:border-primary focus:ring-0" />
                            </label>

                            <label class="flex flex-col min-w-40 flex-1 text-left">
                                <p class="text-text-light text-base font-medium leading-normal pb-2">Telefone com WhatsApp</p>
                                <input id="freela-phone" placeholder="(XX) XXXXX-XXXX"
                                    class="form-input w-full rounded-lg text-text-light bg-gray-100 h-14 placeholder:text-gray-500 p-4 border border-gray-300 focus:border-primary focus:ring-0" />
                            </label>
                        </div>
                        
                        <h3 class="text-text-light font-bold leading-tight pb-2 pt-4 text-left">Segurança</h3>
                        <div class="space-y-4">
                            <label class="flex flex-col min-w-40 flex-1 text-left">
                                <p class="text-text-light text-base font-medium leading-normal pb-2">Senha</p>
                                <input id="freela-password" type="password" placeholder="Crie uma senha segura"
                                    class="form-input w-full rounded-lg text-text-light bg-gray-100 h-14 placeholder:text-gray-500 p-4 border border-gray-300 focus:border-primary focus:ring-0" />
                            </label>
                            
                            <label class="flex flex-col min-w-40 flex-1 text-left">
                                <p class="text-text-light text-base font-medium leading-normal pb-2">Confirme sua senha</p>
                                <input id="freela-password-confirm" type="password" placeholder="Repita a senha"
                                    class="form-input w-full rounded-lg text-text-light bg-gray-100 h-14 placeholder:text-gray-500 p-4 border border-gray-300 focus:border-primary focus:ring-0" />
                            </label>
                        </div>

                        <div class="py-3">
                            <label class="flex items-start gap-3">
                                <input id="freela-terms" type="checkbox"
                                    class="h-5 w-5 rounded border-gray-300 border-2 bg-transparent text-primary focus:ring-0 focus:border-primary" />
                                <p class="text-gray-600 text-base font-normal leading-normal text-left">
                                    Concordo com os **Termos de Uso** e **Política de Privacidade**.
                                </p>
                            </label>
                        </div>

                        <p id="register-error" class="text-red-600 text-sm pb-3 text-center"></p>

                        <div class="flex pt-3 pb-5">
                            <button id="register-button" type="button"
                                class="flex max-w-full cursor-pointer items-center justify-center overflow-hidden rounded-lg h-12 px-5 flex-1 bg-primary text-black text-base font-bold leading-normal tracking-[0.015em] hover:bg-yellow-600 transition-colors">
                                <span class="truncate">Cadastrar Freelancer</span>
                            </button>
                        </div>

                        <p class="text-gray-500 text-sm font-normal text-center">
                            <a href="Login.html" class="underline hover:text-primary transition-colors">Já tenho conta</a>
                        </p>
                    </form>
                </div>
            </main>
            
            <footer class="flex justify-center border-t border-solid border-t-gray-200 mt-auto pt-8">
                <div class="flex max-w-[960px] flex-1 flex-col py-4">
                    <p class="text-gray-500 text-sm font-normal leading-normal px-4 text-center">© 2025 AssisFreela. Todos os direitos reservados.</p>
                </div>
            </footer>
        </div>
    </div>
    
<script>
    // Função auxiliar para validar se a pessoa tem menos de 18 anos
    function isUnderEighteen(birthdateString) {
        // Assume o formato DD/MM/AAAA
        const parts = birthdateString.split('/');
        if (parts.length !== 3) return true; // Formato inválido é tratado como menor de idade por segurança

        const day = parseInt(parts[0], 10);
        const month = parseInt(parts[1], 10);
        const year = parseInt(parts[2], 10);

        if (isNaN(day) || isNaN(month) || isNaN(year)) return true;

        const birthDate = new Date(year, month - 1, day); // month - 1 porque JS é 0-based
        const today = new Date();
        const ageInMilliseconds = today - birthDate;
        
        // Define o limite de 18 anos em milissegundos (aproximadamente)
        // 1000ms * 60s * 60min * 24h * 365.25 dias * 18 anos
        const eighteenYearsInMs = 568036800000; 

        return ageInMilliseconds < eighteenYearsInMs;
    }

    document.addEventListener('DOMContentLoaded', () => {
        const button = document.getElementById('register-button');
        const errorElement = document.getElementById('register-error');
        
        // Variáveis SINCRONIZADAS com o HTML
        const fullnameInput = document.getElementById('freela-fullname');
        const birthdateInput = document.getElementById('freela-birthdate'); // <-- Novo foco de validação
        const emailInput = document.getElementById('freela-email');
        const phoneInput = document.getElementById('freela-phone');
        const passwordInput = document.getElementById('freela-password');
        const passwordConfirmInput = document.getElementById('freela-password-confirm');
        const termsInput = document.getElementById('freela-terms');

        button.addEventListener('click', async () => {
            errorElement.textContent = '';
            const password = passwordInput.value;
            const passwordConfirm = passwordConfirmInput.value;
            
            // --- NOVA VALIDAÇÃO DE IDADE ---
            if (isUnderEighteen(birthdateInput.value)) {
                errorElement.textContent = 'É necessário ter no mínimo 18 anos para se cadastrar.';
                return;
            }
            // --- Fim Validação de Idade ---

            // --- Validações de Senha e Termos ---
            if (password !== passwordConfirm) {
                errorElement.textContent = 'As senhas não conferem.';
                return;
            }
            if (!termsInput.checked) {
                errorElement.textContent = 'Você precisa aceitar os termos e condições.';
                return;
            }

            // --- Montar Dados para Enviar ---
            const dataToSend = {
                // OBSERVAÇÃO: Seu backend precisará do campo 'birth_date'
                full_name: fullnameInput.value,
                birth_date: birthdateInput.value, // Enviamos a data como string (DD/MM/AAAA)
                email: emailInput.value,
                phone: phoneInput.value,
                password: password
                // Outros campos como CPF, address, industry devem ser adicionados se existirem no HTML e no modelo do FastAPI.
            };

            try {
                // TENTAR O CADASTRO (URL CORRIGIDA)
                const registerResponse = await fetch('http://127.0.0.1:8000/register/freelancer', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(dataToSend)
                });

                const registerData = await registerResponse.json();
                
                if (!registerResponse.ok) {
                    const errorDetail = registerData.detail || `Erro ${registerResponse.status}: ${registerResponse.statusText}`;
                    throw new Error(errorDetail);
                }
                
                // LOGIN AUTOMÁTICO
                const loginResponse = await fetch('http://127.0.0.1:8000/login', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ email: emailInput.value, password: password })
                });
                
                const loginData = await loginResponse.json();
                
                if (!loginResponse.ok) {
                    alert('Cadastro criado com sucesso! Faça o login manual para continuar.');
                    window.location.href = 'Login.html';
                    return;
                }
                
                // SUCESSO! SALVAR TOKEN E REDIRECIONAR
                localStorage.setItem('access_token', loginData.access_token);
                localStorage.setItem('role', loginData.role);

                window.location.href = 'Pagina_Freelancer/Perfil_Freelancer.html'; 

            } catch (error) {
                console.error('Erro no processo de cadastro:', error);
                errorElement.textContent = `Falha no envio: ${error.message}`;
            }
        });
    });
</script>
</body>
</html>